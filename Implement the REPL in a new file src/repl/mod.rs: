use crate::brain::process_command;
use crate::config::AxiomConfig;
use crate::context;
use std::io::{self, Write};

pub async fn start_repl(config: AxiomConfig) -> anyhow::Result<()> {
    println!("Starting Axiom REPL. Type 'exit' or 'quit' to end session.");
    
    loop {
        print!("axiom> ");
        io::stdout().flush()?;
        
        let mut input = String::new();
        io::stdin().read_line(&mut input)?;
        let input = input.trim();
        
        if input == "exit" || input == "quit" {
            break;
        }
        
        if input.is_empty() {
            continue;
        }
        
        let context = context::gather().await;
        if let Err(e) = process_command(input, &context, &config).await {
            eprintln!("Error: {}", e);
        }
    }
    
    Ok(())
}